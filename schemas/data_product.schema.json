{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/data_product.schema.json",
  "title": "DataProductSpec",
  "type": "object",
  "required": [
    "name",
    "domain",
    "owner",
    "purpose",
    "interfaces",
    "deployment"
  ],
  "properties": {
    "name": {
      "type": "string",
      "pattern": "^[a-z0-9_-]{3,50}$"
    },
    "domain": {
      "type": "string"
    },
    "owner": {
      "type": "string",
      "format": "email"
    },
    "purpose": {
      "type": "string",
      "minLength": 10
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "upstreams": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "interfaces": {
      "type": "object",
      "required": [
        "outputs"
      ],
      "properties": {
        "outputs": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": [
              "name",
              "type",
              "sink",
              "schema"
            ],
            "properties": {
              "name": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": [
                  "table",
                  "stream",
                  "feature_table",
                  "view"
                ]
              },
              "sink": {
                "type": "string",
                "description": "Physical path or catalog.table"
              },
              "description": {
                "type": "string"
              },
              "freshness_slo": {
                "type": "string",
                "pattern": "^\u2264?\\d+[smhd]$"
              },
              "schema": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "object",
                  "required": [
                    "name",
                    "type"
                  ],
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string"
                    },
                    "nullable": {
                      "type": "boolean",
                      "default": true
                    },
                    "primary_key": {
                      "type": "boolean",
                      "default": false
                    },
                    "pii": {
                      "type": "boolean",
                      "default": false
                    },
                    "classification": {
                      "type": "string",
                      "enum": [
                        "personal",
                        "sensitive",
                        "confidential",
                        "public"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "sla": {
      "type": "object",
      "properties": {
        "availability": {
          "type": "string",
          "pattern": "^99(\\.\\d)?%$"
        },
        "latency": {
          "type": "string",
          "pattern": "^\u2264?\\d+[smhd]$"
        }
      }
    },
    "deployment": {
      "type": "object",
      "required": [
        "runtime",
        "environments"
      ],
      "properties": {
        "runtime": {
          "type": "string",
          "enum": [
            "databricks"
          ]
        },
        "environments": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "dev",
              "stg",
              "prod"
            ]
          },
          "minItems": 1
        },
        "cost_center": {
          "type": "string"
        }
      }
    }
  },
  "additionalProperties": false
}